<?php

return <<<'VALUE'
"namespace IPS\\Theme;\nclass class_nexus_front_clients extends \\IPS\\Theme\\Template\n{\n\tpublic $cache_key = '';\n\tfunction address( $address ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div class='ipsType_normal'>\n\t{$address->address->toString('<br>')}\n<\/div>\n<ul class='ipsList_inline ipsType_medium ipsSpacer_top ipsSpacer_half'>\n\t<li><a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=addresses&do=form&id={$address->id}\", null, \"clientsaddresses\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-ipsDialog data-ipsDialog-size='narrow' data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit_address_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit_address_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t<li><a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=addresses&do=delete&id={$address->id}\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"clientsaddresses\", array(), 0 ) );\n$return .= <<<CONTENT\n\" data-confirm data-confirmMessage='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete_address_confirm', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete_address_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n<\/ul>\n\n\nCONTENT;\n\nif ( !$address->primary_billing || !$address->primary_shipping ):\n$return .= <<<CONTENT\n\n\t<ul class='ipsList_inline'>\n\t\t<li>\n\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'set_as_address', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t<\/li>\n\t\t\nCONTENT;\n\nif ( !$address->primary_billing ):\n$return .= <<<CONTENT\n\n\t\t\t<li>\n\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=addresses&do=primary&id={$address->id}&primary=billing\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"clientsaddresses\", array(), 0 ) );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_narrow ipsButton_light ipsButton_verySmall' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'address_billing_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'address_billing', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t<\/li>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( !$address->primary_shipping ):\n$return .= <<<CONTENT\n\n\t\t\t<li>\n\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=addresses&do=primary&id={$address->id}&primary=shipping\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"clientsaddresses\", array(), 0 ) );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_narrow ipsButton_light ipsButton_verySmall' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'address_shipping_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'address_shipping', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t<\/li>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/ul>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction addresses( $billingAddress = NULL, $shippingAddress = NULL, $otherAddresses ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=addresses&do=form\", null, \"clientsaddresses\", array(), 0 ) );\n$return .= <<<CONTENT\n' class='ipsPos_right ipsButton ipsButton_important ipsButton_verySmall' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'address_add_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'address_add', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n<h1 class='ipsType_pageTitle'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'address_book', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h1>\n\n<p class='ipsType_reset ipsType_normal ipsSpacer_bottom ipsSpacer_double'>\n\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'address_book_info', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n<\/p>\n\n\nCONTENT;\n\nif ( $billingAddress || $shippingAddress ):\n$return .= <<<CONTENT\n\n\t<div class='ipsGrid ipsGrid_collapsePhone'>\n\t\t\nCONTENT;\n\nif ( $billingAddress ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsGrid_span6 ipsBox ipsPad'>\n\t\t\t\t<h2 class='ipsType_sectionHead ipsSpacer_bottom'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'address_default_billing', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"clients\", \"nexus\" )->address( $billingAddress );\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( $shippingAddress ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsGrid_span6 ipsBox ipsPad'>\n\t\t\t\t<h2 class='ipsType_sectionHead ipsSpacer_bottom'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'address_default_shipping', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"clients\", \"nexus\" )->address( $shippingAddress );\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\nCONTENT;\n\nif ( count( $otherAddresses ) ):\n$return .= <<<CONTENT\n\n\t<hr class='ipsHr'>\n\t<div class='ipsPad'>\n\t\t<h2 class='ipsType_sectionHead ipsSpacer_bottom'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'address_other_addresses', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t<ul class='ipsGrid ipsGrid_collapsePhone' data-ipsGrid data-ipsGrid-minItemSize='350' data-ipsGrid-maxItemSize='600' data-ipsGrid-equalHeights='row'>\n\t\t\t\nCONTENT;\n\nforeach ( $otherAddresses as $address ):\n$return .= <<<CONTENT\n\n\t\t\t\t<li class='ipsGrid_span6'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"clients\", \"nexus\" )->address( $address );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/li>\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t<\/ul>\n\t<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction alternatives( $protected=FALSE ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=alternatives&do=form\", null, \"clientsalternatives\", array(), 0 ) );\n$return .= <<<CONTENT\n' class='ipsPos_right ipsButton ipsButton_important ipsButton_verySmall' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_add_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" data-ipsDialog data-ipsDialog-size='medium' data-ipsDialog-title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_add', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_add', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n<h1 class='ipsType_pageTitle'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h1>\n\n<p class='ipsType_reset ipsType_normal ipsSpacer_bottom ipsSpacer_double'>\n\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_info', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n<\/p>\n\n\nCONTENT;\n\nif ( !$protected ):\n$return .= <<<CONTENT\n\n\t\nCONTENT;\n\nif ( !count( \\IPS\\nexus\\Customer::loggedIn()->alternativeContacts() ) ):\n$return .= <<<CONTENT\n\n\t\t<div class='ipsBox ipsPad ipsType_large ipsType_center ipsType_light'>\n\t\t\t\nCONTENT;\n\n$sprintf = array(\\IPS\\Member::loggedIn()->language()->addToStack('altcontact_add')); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_none', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t<ul class='ipsBox ipsPad ipsDataList ipsDataList_large'>\n\t\t\t\nCONTENT;\n\nforeach ( \\IPS\\nexus\\Customer::loggedIn()->alternativeContacts() as $contact ):\n$return .= <<<CONTENT\n\n\t\t\t\t<li class='ipsDataItem cAlternateContactPerms'>\n\t\t\t\t\t<div class='ipsDataItem_icon ipsPos_top'>\n\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->userPhoto( $contact->alt_id );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t\t<h2 class='ipsDataItem_title ipsType_large ipsType_blendLinks'>\n\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->userLink( $contact->alt_id );\n$return .= <<<CONTENT\n \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_can', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n:<\/strong>\n\t\t\t\t\t\t<\/h2>\n\t\t\t\t\t\t<ul class='ipsList_reset cAlternateContactPerms_perms'>\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( count( $contact->purchases ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsPhotoPanel ipsPhotoPanel_tiny ipsClearfix'>\n\t\t\t\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_positive ipsPos_left'>\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-check'><\/i>\n\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\t<div class='ipsType_normal'>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$pluralize = array( count( $contact->purchases ), count( $contact->purchases ) ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_perm_manage', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<ul class=\"ipsDataItem_subList ipsList_inline\">\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $contact->purchases as $purchase ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $purchase->url(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\nCONTENT;\n$return .= htmlspecialchars( $purchase->name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $contact->support ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsPhotoPanel ipsPhotoPanel_tiny ipsClearfix'>\n\t\t\t\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_positive ipsPos_left'>\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-check'><\/i>\n\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\t<div class='ipsType_normal'>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_perm_support', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsPhotoPanel ipsPhotoPanel_tiny ipsFaded ipsClearfix'>\n\t\t\t\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_neutral ipsPos_left'>\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-times'><\/i>\n\t\t\t\t\t\t\t\t\t<\/span> \n\t\t\t\t\t\t\t\t\t<div class='ipsType_normal'>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_perm_support', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $contact->billing ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsPhotoPanel ipsPhotoPanel_tiny ipsClearfix'>\n\t\t\t\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_positive ipsPos_left'>\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-check'><\/i>\n\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\t<div class='ipsType_normal'>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_perm_billing', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<li class='ipsPhotoPanel ipsPhotoPanel_tiny ipsFaded ipsClearfix'>\n\t\t\t\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_neutral ipsPos_left'>\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-times'><\/i>\n\t\t\t\t\t\t\t\t\t<\/span> \n\t\t\t\t\t\t\t\t\t<div class='ipsType_normal'>\n\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_perm_billing', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size3 ipsPos_top'>\n\t\t\t\t\t\t<ul class='ipsToolList ipsToolList_vertical'>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=alternatives&do=form&id={$contact->alt_id->member_id}\", null, \"clientsalternatives\", array(), 0 ) );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_light ipsButton_verySmall ipsButton_fullWidth' data-ipsDialog data-ipsDialog-size='medium' data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_edit', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_edit', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=alternatives&do=delete&id={$contact->alt_id->member_id}\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"clientsalternatives\", array(), 0 ) );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_light ipsButton_verySmall ipsButton_fullWidth' data-confirm data-confirmMessage=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_delete_confirm', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\" title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'altcontact_delete', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/li>\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t<\/ul>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction billingAgreement( $billingAgreement, $purchases, $invoices, $invoicePagination ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div class=\"ipsClearfix ipsSpacer_bottom\">\n\t<div class='ipsType_large ipsType_center ipsPos_left ipsPad_half'>\n\t\t\nCONTENT;\n\nif ( $billingAgreement->status() === \\IPS\\nexus\\Customer\\BillingAgreement::STATUS_ACTIVE ):\n$return .= <<<CONTENT\n\n\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_positive' data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_active', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t<i class='fa fa-check ipsType_large'><\/i>\n\t\t\t<\/span>\n\t\t\nCONTENT;\n\nelseif ( $billingAgreement->status() === \\IPS\\nexus\\Customer\\BillingAgreement::STATUS_SUSPENDED ):\n$return .= <<<CONTENT\n\n\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_neutral'  data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_suspended', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t<i class='fa fa-clock-o ipsType_large'><\/i>\n\t\t\t<\/span>\n\t\t\nCONTENT;\n\nelseif ( $billingAgreement->status() === \\IPS\\nexus\\Customer\\BillingAgreement::STATUS_CANCELED ):\n$return .= <<<CONTENT\n\n\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_negative'  data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_canceled', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t<i class='fa fa-times ipsType_large'><\/i>\n\t\t\t<\/span>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n\t<div class=\"ipsPos_left\">\n\t\t<h1 class='ipsType_pageTitle'>\nCONTENT;\n\n$sprintf = array($billingAgreement->gw_id); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/h1>\n\t\t<span class=\"cNexusPrice ipsType_large\">\nCONTENT;\n$return .= htmlspecialchars( $billingAgreement->term(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t<\/div>\n\t<div class=\"ipsPos_right ipsType_right ipsType_normal\">\n\t\t\nCONTENT;\n\nif ( $billingAgreement->status() === \\IPS\\nexus\\Customer\\BillingAgreement::STATUS_ACTIVE ):\n$return .= <<<CONTENT\n\n\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $billingAgreement->url()->setQueryString( array( 'do' => 'act', 'act' => 'suspend' ) )->csrf(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsButton ipsButton_verySmall ipsButton_light\" data-confirm data-confirmSubMessage=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_suspend_confirm', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_suspend', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( $billingAgreement->status() === \\IPS\\nexus\\Customer\\BillingAgreement::STATUS_SUSPENDED ):\n$return .= <<<CONTENT\n\n\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $billingAgreement->url()->setQueryString( array( 'do' => 'act', 'act' => 'reactivate' ) )->csrf(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsButton ipsButton_verySmall ipsButton_light\" data-confirm>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_reactivate', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( $billingAgreement->status() !== \\IPS\\nexus\\Customer\\BillingAgreement::STATUS_CANCELED ):\n$return .= <<<CONTENT\n\n\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $billingAgreement->url()->setQueryString( array( 'do' => 'act', 'act' => 'cancel' ) )->csrf(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsButton ipsButton_verySmall ipsButton_light\" data-confirm>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_cancel', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\n\nCONTENT;\n\nif ( count( $purchases[0] ) ):\n$return .= <<<CONTENT\n\n\t<hr class=\"ipsHr\">\n\t<h2 class=\"ipsType_sectionHead ipsSpacer_bottom\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_purchases', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t<ul class='ipsList_reset'>\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"clients\", \\IPS\\Request::i()->app )->purchaseList( 0, $purchases, FALSE, $billingAgreement );\n$return .= <<<CONTENT\n\n\t<\/ul>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n<hr class=\"ipsHr\">\n<h2 class=\"ipsType_sectionHead ipsSpacer_bottom\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_payments', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n{$invoicePagination}\n\t<ul class='ipsDataList ipsDataList_large cNexusOrderList'>\n\t\t\nCONTENT;\n\nforeach ( $invoices as $invoice ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"clients\", \\IPS\\Request::i()->app )->invoiceList( $invoice, $billingAgreement );\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t<\/ul>\n{$invoicePagination}\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction billingAgreements( $billingAgreements ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<h1 class='ipsType_pageTitle'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreements_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h1>\n\n<p class='ipsType_normal'>\n\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreements_info', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n<\/p>\n\n\nCONTENT;\n\nif ( !count( $billingAgreements ) ):\n$return .= <<<CONTENT\n\n\t<div class='ipsPad ipsType_large ipsType_center ipsType_light'>\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreements_none', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t<\/div>\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t<ol class='ipsDataList ipsDataList_reducedSpacing'>\n\t\t\nCONTENT;\n\nforeach ( $billingAgreements as $billingAgreement ):\n$return .= <<<CONTENT\n\n\t\t\t<li class='ipsDataItem'>\n\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size1 ipsType_large ipsType_center ipsPos_middle'>\n\t\t\t\t\t\nCONTENT;\n\nif ( $billingAgreement['status'] === \\IPS\\nexus\\Customer\\BillingAgreement::STATUS_ACTIVE ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_positive' data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_active', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t<i class='fa fa-check ipsType_large'><\/i>\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\nCONTENT;\n\nelseif ( $billingAgreement['status'] === \\IPS\\nexus\\Customer\\BillingAgreement::STATUS_SUSPENDED ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_neutral'  data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_suspended', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t<i class='fa fa-clock-o ipsType_large'><\/i>\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\nCONTENT;\n\nelseif ( $billingAgreement['status'] === \\IPS\\nexus\\Customer\\BillingAgreement::STATUS_CANCELED ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_negative'  data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_canceled', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t<i class='fa fa-times ipsType_large'><\/i>\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_neutral'  data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_unknown', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t<i class='fa fa-question ipsType_large'><\/i>\n\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t<strong class='ipsType_large'>\nCONTENT;\n$return .= htmlspecialchars( $billingAgreement['id'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t<p class='ipsDataItem_meta cNexusPrice'>\n\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $billingAgreement['term'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/p>\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size4 ipsType_right'>\n\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $billingAgreement['url'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_light ipsButton_verySmall'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_agreement_view', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t<\/div>\n\t\t\t<\/tr>\n\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t<\/ol>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction cards( $cards ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=cards&do=add\", null, \"clientscards\", array(), 0 ) );\n$return .= <<<CONTENT\n' class='ipsPos_right ipsButton ipsButton_important ipsButton_verySmall' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cards_add_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cards_add', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n<h1 class='ipsType_pageTitle'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cards_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h1>\n\n<p class='ipsType_reset ipsType_normal ipsSpacer_bottom ipsSpacer_double'>\n\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cards_info', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n<\/p>\n\n<ul class='ipsList_inline cNexusCards ipsSpacer_top ipsBox ipsPad'>\n\t\nCONTENT;\n\nforeach ( $cards as $card ):\n$return .= <<<CONTENT\n\n\t\t<li>\n\t\t\t<span class='cNexusCards_number'>\n\t\t\t\t\nCONTENT;\n\nif ( $card['card_type'] == 'american_express' OR $card['card_type'] == 'diners_club' ):\n$return .= <<<CONTENT\n\n\t\t\t\t\tXXXX XXXXXX X\nCONTENT;\n$return .= htmlspecialchars( $card['card_number'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\tXXXX XXXX XXXX \nCONTENT;\n$return .= htmlspecialchars( $card['card_number'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/span>\n\t\t\t\nCONTENT;\n\nif ( $card['card_type'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='cNexusCards_type cPayment cPayment_\nCONTENT;\n$return .= htmlspecialchars( $card['card_type'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$val = \"card_type_{$card['card_type']}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( $card['card_expire'] ):\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='cNexusCards_expTitle'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cards_exp', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t<span class='cNexusCards_exp'>\nCONTENT;\n$return .= htmlspecialchars( $card['card_expire'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\n\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=cards&do=delete&id={$card['id']}\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"clientscards\", array(), 0 ) );\n$return .= <<<CONTENT\n\" class='cNexusCards_delete' data-confirm data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete_this_card', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>&times;<\/a>\n\t\t<\/li>\n\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n<\/ul>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction credit( $balance, $pastWithdrawals, $pastWithdrawalsPagination, $canWithdraw, $canTopup ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<h1 class='ipsType_pageTitle'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h1>\n\n<div class='ipsBox ipsPad ipsSpacer_top ipsSpacer_double'>\n<div class='ipsColumns ipsColumns_collapsePhone'>\n\t<div class='ipsColumn ipsColumn_wide'>\n\t\t\nCONTENT;\n\nif ( count( $balance ) ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nforeach ( $balance as $amount ):\n$return .= <<<CONTENT\n\n\t\t\t\t<h2 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_balance', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( count( $balance ) > 1 ):\n$return .= <<<CONTENT\n(\nCONTENT;\n$return .= htmlspecialchars( $amount->currency, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n)\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t\t<div class='cNexusCredit_total ipsSpacer_bottom'>\n\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $amount, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nelseif ( $balance !== NULL ):\n$return .= <<<CONTENT\n\n\t\t\t<h2 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_balance', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t<div class='cNexusCredit_total ipsSpacer_bottom'>\n\t\t\t\t\nCONTENT;\n\n$return .= new \\IPS\\nexus\\Money( 0, \\IPS\\nexus\\Customer::loggedIn()->defaultCurrency() );\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( $canWithdraw or $canTopup ):\n$return .= <<<CONTENT\n\n\t\t\t<ul class='ipsToolList ipsToolList_vertical'>\n\t\t\t\t\nCONTENT;\n\nif ( $canTopup ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=credit&do=topup\", null, \"clientscredit\", array(), 0 ) );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-size='narrow' data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_add', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' class='ipsButton ipsButton_important ipsButton_fullWidth ipsButton_medium' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_add_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_add', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $canWithdraw ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><a href='\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=credit&do=withdraw\", null, \"clientscredit\", array(), 0 ) );\n$return .= <<<CONTENT\n' data-ipsDialog data-ipsDialog-size='medium' data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_withdraw_dialog', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' class='ipsButton ipsButton_light ipsButton_fullWidth ipsButton_medium' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_withdraw_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_withdraw', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nif ( count( \\IPS\\nexus\\Customer::loggedIn()->parentContacts( array('billing=1') ) ) ):\n$return .= <<<CONTENT\n\n\t\t\t<hr class='ipsHr'>\n\t\t\t<p class='ipsType_medium'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_altcontact', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\nCONTENT;\n\nforeach ( \\IPS\\nexus\\Customer::loggedIn()->parentContacts( array('billing=1') ) as $contact ):\n$return .= <<<CONTENT\n\n\t\t\t\t<hr class='ipsHr'>\n\t\t\t\t<div class='ipsPhotoPanel ipsPhotoPanel_tiny ipsClearfix'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->userPhoto( $contact->main_id, 'tiny' );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<h3 class='ipsType_reset'>\nCONTENT;\n$return .= htmlspecialchars( $contact->main_id->cm_name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/h3>\n\n\t\t\t\t\t\t\nCONTENT;\n\n$val = FALSE;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $contact->main_id->cm_credits as $credit ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $credit->amount->isGreaterThanZero() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\n$val = TRUE;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<h2 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_balance', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( count( $contact->main_id->cm_credits ) > 1 ):\n$return .= <<<CONTENT\n(\nCONTENT;\n$return .= htmlspecialchars( $credit->currency, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n)\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t\t\t\t\t\t<div class='cNexusCredit_total cNexusCredit_contact ipsSpacer_bottom'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $credit, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( !$val ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<h2 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_balance', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t\t\t\t\t<div class='cNexusCredit_total cNexusCredit_contact ipsSpacer_bottom'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= new \\IPS\\nexus\\Money( 0, $contact->main_id->defaultCurrency() );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n\t<div class='ipsColumn ipsColumn_fluid'>\n\t\t\nCONTENT;\n\nif ( isset( \\IPS\\Request::i()->withdraw ) ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( \\IPS\\Request::i()->withdraw === 'success' ):\n$return .= <<<CONTENT\n\n\t\t\t\t<p class=\"ipsMessage ipsMessage_success\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'payout_status_success', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t<br>\n\t\t\t\nCONTENT;\n\nelseif ( \\IPS\\Request::i()->withdraw === 'pending' ):\n$return .= <<<CONTENT\n\n\t\t\t\t<p class=\"ipsMessage ipsMessage_info\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'payout_status_pending', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t<br>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\nCONTENT;\n\nif ( count( $pastWithdrawals ) or $canWithdraw ):\n$return .= <<<CONTENT\n\n\t\t\t<h2 class='ipsType_sectionHead'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_withdrawal_history', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t\nCONTENT;\n\nif ( count( $pastWithdrawals ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<ol class='ipsDataList ipsDataList_reducedSpacing'>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( $pastWithdrawals as $withdrawal ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li class='ipsDataItem'>\n\t\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size1 ipsType_large ipsType_center ipsPos_middle'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $withdrawal->status === \\IPS\\nexus\\Payout::STATUS_COMPLETE ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_positive' data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_withdraw_complete', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-check ipsType_large'><\/i>\n\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $withdrawal->status === \\IPS\\nexus\\Payout::STATUS_PENDING ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_neutral'  data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_withdraw_pending', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-clock-o ipsType_large'><\/i>\n\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelseif ( $withdrawal->status === \\IPS\\nexus\\Payout::STATUS_CANCELED ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_negative'  data-ipsTooltip title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_withdraw_cancelled', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\n\t\t\t\t\t\t\t\t\t\t<i class='fa fa-times ipsType_large'><\/i>\n\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t\t\t\t<strong class='ipsType_large'>\nCONTENT;\n$return .= htmlspecialchars( $withdrawal->amount, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t\t\t<p class='ipsDataItem_meta ipsType_light'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$val = ( $withdrawal->date instanceof \\IPS\\DateTime ) ? $withdrawal->date : \\IPS\\DateTime::ts( $withdrawal->date );$return .= $val->html();\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $withdrawal->status === \\IPS\\nexus\\Payout::STATUS_PENDING ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size4 ipsType_right'>\n\t\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=credit&do=cancel&id={$withdrawal->id}\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, null, \"clientscredit\", array(), 0 ) );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_light ipsButton_verySmall' data-confirm data-confirmMessage='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_withdraw_cancel_confirm', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cancel', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/ol>\n\t\t\t\t{$pastWithdrawalsPagination}\n\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t<p class='ipsType_light ipsType_large ipsType_center'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'credit_no_withdrawals', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction donations(  ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<h1 class='ipsType_pageTitle'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'current_donation_goals', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h1>\n\n\nCONTENT;\n\nif ( \\IPS\\Request::i()->thanks ):\n$return .= <<<CONTENT\n\n\t<p class=\"ipsMessage ipsMessage_success\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'thanks_for_your_donation', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\t<br>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\nCONTENT;\n\nforeach ( \\IPS\\nexus\\Donation\\Goal::roots() as $goal ):\n$return .= <<<CONTENT\n\n\t<div class=\"ipsAreaBackground_light\" id=\"elDonationGoal\nCONTENT;\n$return .= htmlspecialchars( $goal->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t<h2 class=\"ipsType_sectionTitle ipsType_reset\">\nCONTENT;\n$return .= htmlspecialchars( $goal->_title, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/h2>\n\t\t<div class=\"ipsPad\">\n\t\t\t\nCONTENT;\n\nif ( $desc = \\IPS\\Member::loggedIn()->language()->get(\"nexus_donategoal_{$goal->id}_desc\") ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class=\"ipsAreaBackground_reset ipsPad ipsSpacer_bottom\">\n\t\t\t\t\t<div class=\"ipsType_richText\">\n\t\t\t\t\t\t{$desc}\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( $goal->goal ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class=\"cDonateProgressBar\">\n\t\t\t\t\t<div class=\"cDonateProgressBar_progress\" style=\"width:\nCONTENT;\n\n$return .= htmlspecialchars( 100\/$goal->goal*$goal->current, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n%\"><\/div>\n\t\t\t\t<\/div>\n\t\t\t\t<p class=\"ipsType_center ipsType_normal\">\n\t\t\t\t\t<strong>\nCONTENT;\n\n$htmlsprintf = array(new \\IPS\\nexus\\Money( $goal->current, $goal->currency ), new \\IPS\\nexus\\Money( $goal->goal, $goal->currency )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'donate_progress', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'htmlsprintf' => $htmlsprintf ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t<\/p>\n\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t<p class=\"ipsType_center ipsType_normal\">\n\t\t\t\t\t<strong>\nCONTENT;\n\n$htmlsprintf = array(new \\IPS\\nexus\\Money( $goal->current, $goal->currency )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'donate_sofar', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'htmlsprintf' => $htmlsprintf ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t<\/p>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\t<div class=\"ipsAreaBackground ipsPad ipsType_center\">\n\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $goal->url()->setQueryString( 'noDesc', 1 ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsButton ipsButton_primary\" data-ipsDialog>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'donate_to_goal', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t<\/div>\n\t<\/div>\n\t<br>\n\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction info( $form ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<h1 class='ipsType_pageTitle'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'customerinfo_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h1>\n\n<div class='ipsBox ipsPad ipsSpacer_top'>\n\t{$form}\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction invoice( $invoice ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<div class='ipsPos_right ipsType_right ipsType_normal'>\n\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $invoice->url()->setQueryString( 'printout', 'true' ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' target=\"_blank\" class='ipsButton ipsButton_verySmall ipsButton_light'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_invoice_print', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><br>\n\t\nCONTENT;\n\nif ( $invoice->po ):\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'invoice_po_number', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n: \nCONTENT;\n$return .= htmlspecialchars( $invoice->po, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n <a href=\"\nCONTENT;\n$return .= htmlspecialchars( $invoice->url()->setQueryString( array( 'do' => 'poNumber' ) ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-ipsDialog data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_po_number_dialog', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' class='ipsType_small' title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_po_number', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $invoice->url()->setQueryString( array( 'do' => 'poNumber' ) ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-ipsDialog data-ipsDialog-size='narrow' data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_po_number_dialog', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_po_number_add_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' class='ipsType_small'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_po_number_add', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n<\/div>\n<h1 class='ipsType_pageTitle'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n #\nCONTENT;\n$return .= htmlspecialchars( $invoice->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/h1>\n<p class='ipsType_light ipsType_normal ipsType_reset'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_placed', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n\n$val = ( $invoice->date instanceof \\IPS\\DateTime ) ? $invoice->date : \\IPS\\DateTime::ts( $invoice->date );$return .= $val->html(FALSE);\n$return .= <<<CONTENT\n<\/p>\n<hr class='ipsHr'>\n\n<div class='ipsGrid ipsGrid_collapsePhone ipsSpacer_top cNexusInvoiceView'>\n\t<div class='ipsGrid_span6'>\n\t\t\nCONTENT;\n\nif ( $invoice->billaddress or ( $invoice->hasPhysicalItems() && $invoice->shipaddress )  ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsGrid ipsGrid_collapsePhone ipsSpacer_bottom ipsSpacer_double'>\n\t\t\t\t\nCONTENT;\n\nif ( $invoice->billaddress  ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class='ipsGrid_span6'>\n\t\t\t\t\t\t<h3 class='ipsType_sectionHead'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'billing_address', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t\t<div class='ipsType_medium ipsSpacer_top'>\n\t\t\t\t\t\t\t{$invoice->billaddress->toString('<br>')}\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $invoice->hasPhysicalItems() && $invoice->shipaddress ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div class='ipsGrid_span6'>\n\t\t\t\t\t\t<h3 class='ipsType_sectionHead'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'shipping_address', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t\t<div class='ipsType_medium ipsSpacer_top'>\n\t\t\t\t\t\t\t{$invoice->shipaddress->toString('<br>')}\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\nCONTENT;\n\nif ( $invoice->notes ):\n$return .= <<<CONTENT\n\n\t\t\t<h2 class='ipsType_sectionHead'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'invoice_notes', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n &nbsp;&nbsp;<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $invoice->url()->setQueryString( array( 'do' => 'notes' ) ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" data-ipsDialog data-ipsDialog-size='narrow' data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_edit_invoice_notes', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' class='ipsType_small'>(\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n)<\/a><\/h2>\n\t\t\t<div class='ipsType_normal'>\n\t\t\t \t\nCONTENT;\n\n$return .= nl2br( htmlspecialchars( $invoice->notes, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ) );\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t<p class='ipsSpacer_top'><a href=\"\nCONTENT;\n$return .= htmlspecialchars( $invoice->url()->setQueryString( array( 'do' => 'notes' ) ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_light ipsButton_verySmall' data-ipsDialog data-ipsDialog-size='narrow' data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_edit_invoice_notes', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_add_invoice_notes', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_add_invoice_notes', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/p>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n\t<div class='ipsGrid_span6 ipsAreaBackground_light ipsPad ipsType_center'>\n\t\t<div class='ipsBox ipsPad'>\n\t\t\t<h2 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_order_total', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t<span class='cNexusOrderBadge cNexusOrderBadge_\nCONTENT;\n\n$val = \"{$invoice->status}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$val = \"istatus_{$invoice->status}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span> &nbsp;&nbsp;&nbsp;<span class='cNexusPrice'>\nCONTENT;\n$return .= htmlspecialchars( $invoice->total, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\n\t\t\t\nCONTENT;\n\nif ( $invoice->status === $invoice::STATUS_PENDING ):\n$return .= <<<CONTENT\n\n\t\t\t\t<ul class='ipsToolList ipsToolList_vertical ipsSpacer_top'>\n\t\t\t\t\t<li><a href=\"\nCONTENT;\n$return .= htmlspecialchars( $invoice->checkoutUrl(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_primary ipsButton_fullWidth ipsButton_small' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_pay_now_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_pay_now', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\t<li><a href=\"\nCONTENT;\n$return .= htmlspecialchars( $invoice->url()->setQueryString( 'do', 'cancel' )->csrf(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_light ipsButton_fullWidth ipsButton_small' data-confirm title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_cancel_invoice', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cancel', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t<\/ul>\n\t\t\t\nCONTENT;\n\nelseif ( $invoice->status === $invoice::STATUS_EXPIRED ):\n$return .= <<<CONTENT\n\n\t\t\t\t<p class='ipsType_center ipsType_light ipsType_reset ipsSpacer_top'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_invoice_expired', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\t\t\t\nCONTENT;\n\nelseif ( $invoice->status === $invoice::STATUS_CANCELED ):\n$return .= <<<CONTENT\n\n\t\t\t\t<p class='ipsType_center ipsType_light ipsType_reset ipsSpacer_top'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_invoice_cancelled', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\t\t\t\nCONTENT;\n\nelseif ( $invoice->status === $invoice::STATUS_PAID ):\n$return .= <<<CONTENT\n\n\t\t\t\t<p class='ipsType_center ipsType_light ipsType_reset ipsSpacer_top'>\n\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_invoice_paid', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<br>\n\t\t\t\t\t\nCONTENT;\n\nif ( $invoice->billaddress ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href='#elPaymentDetails' data-ipsDialog data-ipsDialog-content='#elPaymentDetails' data-ipsDialog-title='\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_payment_details', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n' data-ipsDialog-size='narrow'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_view_payment', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\n\t\t\t\t\nCONTENT;\n\nif ( $invoice->billaddress ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<div id='elPaymentDetails' class='ipsType_left ipsJS_hide'>\n\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"clients\", \"nexus\" )->paymentLog( $invoice );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/div>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t<\/div>\n<\/div>\n\n<hr class='ipsHr'>\n\n\nCONTENT;\n\n$shipments = $invoice->shipments( array( \\IPS\\nexus\\Shipping\\Order::STATUS_SHIPPED, \\IPS\\nexus\\Shipping\\Order::STATUS_PENDING ) );\n$return .= <<<CONTENT\n\n\nCONTENT;\n\n$summary = $invoice->summary();\n$return .= <<<CONTENT\n\n\n\nCONTENT;\n\nif ( count( $shipments ) ):\n$return .= <<<CONTENT\n\n\t<div class='ipsColumns ipsColumns_collapsePhone'>\n\t\t<div class='ipsColumn ipsColumn_fluid'>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<div class='ipsBox'>\n\t\t\t<h2 class='ipsType_sectionTitle ipsType_reset'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_details', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t<div class='ipsPad ipsAreaBackground_light'>\n\t\t\t\t<ul class='ipsDataList ipsBox ipsPad'>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( $summary['items'] as $k => $item ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li class='ipsDataItem'>\n\t\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size2'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\ntry { $package = \\IPS\\nexus\\Package::load( $item->id ); } catch( \\Exception $e ) { $package = NULL; } \n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $item instanceof \\IPS\\nexus\\extensions\\nexus\\Item\\Package and $package and $package->image ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<img src=\"\nCONTENT;\n$return .= htmlspecialchars( $package->image, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsImage'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<div class='ipsNoThumb ipsNoThumb_product ipsThumb_small'>&nbsp;<\/div>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t\t\t\t<h2 class='ipsDataItem_title ipsType_sectionHead'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $url = $item->url() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $url, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class=\"ipsType_blendLinks\"><span class='ipsType_light'>\nCONTENT;\n$return .= htmlspecialchars( $item->quantity, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n x<\/span> \nCONTENT;\n$return .= htmlspecialchars( $item->name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<span class='ipsType_light'>\nCONTENT;\n$return .= htmlspecialchars( $item->quantity, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n x<\/span> \nCONTENT;\n$return .= htmlspecialchars( $item->name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/h2>\n\t\t\t\t\t\t\t\t<dl class='ipsList_reset cNexusPurchase_info ipsSpacer_top'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $item->details as $k => $v ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<dt class='ipsType_minorHeading'><strong>\nCONTENT;\n\n$val = \"nexus_pfield_{$k}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong><\/dt>\n\t\t\t\t\t\t\t\t\t\t<dd class='ipsType_normal'>\nCONTENT;\n\n$return .= \\IPS\\nexus\\Package\\CustomField::load( $k )->displayValue( $v );\n$return .= <<<CONTENT\n<\/dd>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/dl>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size4 ipsType_right ipsPos_top'>\n\t\t\t\t\t\t\t\t<span class='cNexusPrice ipsType_large'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $item->linePrice(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $item->quantity > 1 ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<p class='ipsType_reset ipsType_small ipsType_light'>\n                                        \nCONTENT;\n\n$sprintf = array($item->price); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'each_short', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nforeach ( $summary['items'] as $item ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $item instanceof \\IPS\\nexus\\extensions\\nexus\\Item\\CouponDiscount ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='ipsDataItem cNexusCheckout_coupon'>\n\t\t\t\t\t\t\t\t<div class='ipsDataItem_main ipsType_right'>\n\t\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'coupon', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size3 ipsType_right cNexusPrice'>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $item->linePrice(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\t\n\t\t\t\t\t<li class='ipsDataItem cNexusCheckout_subtotal'>\n\t\t\t\t\t\t<div class='ipsDataItem_main ipsType_right'>\n\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'subtotal', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size3 ipsType_right cNexusPrice'>\n\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $summary['subtotal'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( $summary['shipping'] as $shipping ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li class='ipsDataItem'>\n\t\t\t\t\t\t\t<div class='ipsDataItem_main ipsType_right'>\n\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'shipping', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n <span class='ipsType_light ipsType_unbold'>(\nCONTENT;\n$return .= htmlspecialchars( $shipping->name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n)<\/span><\/strong>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size3 ipsType_right cNexusPrice'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $shipping->linePrice(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nforeach ( $summary['tax'] as $tax ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li class='ipsDataItem'>\n\t\t\t\t\t\t\t<div class='ipsDataItem_main ipsType_right'>\n\t\t\t\t\t\t\t\t<strong>\nCONTENT;\n$return .= htmlspecialchars( $tax['name'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n (\nCONTENT;\n\n$return .= htmlspecialchars( $tax['rate']*100, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n%)<\/strong>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size3 ipsType_right cNexusPrice'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $tax['amount'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li class='ipsDataItem ipsType_large cNexusCheckout_subtotal'>\n\t\t\t\t\t\t<div class='ipsDataItem_main ipsType_right'>\n\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'total', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size3 ipsType_right cNexusPrice'>\n\t\t\t\t\t\t\t<strong>\nCONTENT;\n$return .= htmlspecialchars( $summary['total'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/li>\n\t\t\t\t<\/ul>\n\t\t\t<\/div>\n\t\t<\/div>\n\nCONTENT;\n\nif ( count( $shipments ) ):\n$return .= <<<CONTENT\n\n\t<\/div>\n\t<div class='ipsColumn ipsColumn_wide'>\n\t\t<!--<h2 class='ipsType_sectionHead'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'invoice_shipments', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>-->\n\t\t\nCONTENT;\n\nforeach ( $shipments as $shipment ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsAreaBackground_light ipsPad'>\n\t\t\t\t\nCONTENT;\n\nif ( $shipment->status === $shipment::STATUS_SHIPPED ):\n$return .= <<<CONTENT\n\t\n\t\t\t\t\t<div class='ipsSpacer_bottom ipsSpacer_half'>\t\n\t\t\t\t\t\t<h3 class='ipsType_large ipsType_reset'>\nCONTENT;\n\n$val = \"sstatus_{$shipment->status}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t\t<p class='ipsType_medium ipsType_reset'>\n\t\t\t\t\t\t\t\nCONTENT;\n\n$sprintf = array($shipment->shipped_date, $shipment->method->_title); $pluralize = array( $shipment->itemCount() ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_shipped', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf, 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( $shipment->tracknumber ):\n$return .= <<<CONTENT\n<span class='ipsType_light'>(\nCONTENT;\n$return .= htmlspecialchars( $shipment->tracknumber, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n)<\/span>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t\nCONTENT;\n\nif ( $shipment->trackingUrl() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $shipment->trackingUrl(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_light ipsButton_verySmall ipsButton_fullWidth' target=\"_blank\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_track_delivery', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nelseif ( $shipment->status === $shipment::STATUS_PENDING ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<h3 class='ipsType_large ipsType_reset'>\nCONTENT;\n\n$val = \"sstatus_{$shipment->status}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t<p class='ipsType_normal ipsType_reset'>\n\t\t\t\t\t\t\nCONTENT;\n\n$sprintf = array($shipment->method->_title); $pluralize = array( $shipment->itemCount() ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_will_ship', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf, 'pluralize' => $pluralize ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/p>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsBox ipsPad ipsSpacer_top ipsSpacer_half cNexusInvoiceView_shipList'>\n\t\t\t\t\t<ul class='ipsDataList ipsDataList_reducedSpacing'>\n\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $shipment->items as $item ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<li class='ipsDataItem'>\n\t\t\t\t\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t\t\t\t\t<h4 class='ipsType_normal ipsType_reset'><span class='ipsType_light'>\nCONTENT;\n$return .= htmlspecialchars( $item['quantity'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n x<\/span> \nCONTENT;\n$return .= htmlspecialchars( $item['name'], ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/h4>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( count( $item['details'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<span class=\"ipsType_light\">\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nforeach ( $item['details'] as $k => $v ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\n$val = \"{$k}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n: \nCONTENT;\n$return .= htmlspecialchars( $v, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<br>\n\t\t\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/ul>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction invoiceList( $invoice, $fromBillingAgreement=NULL ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<li class='ipsDataItem'>\n\t<div class='ipsDataItem_generic ipsDataItem_size8 ipsPos_top'>\n\t\t<strong class='ipsType_large'>\nCONTENT;\n\n$val = ( $invoice->date instanceof \\IPS\\DateTime ) ? $invoice->date : \\IPS\\DateTime::ts( $invoice->date );$return .= $val->html();\n$return .= <<<CONTENT\n<\/strong><br>\n\t\t<span class='ipsType_normal ipsType_light'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n #\nCONTENT;\n$return .= htmlspecialchars( $invoice->id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span> &middot; <a href='\nCONTENT;\n$return .= htmlspecialchars( $invoice->url(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'orders_view_details_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_view_details', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\n\t\t<p>\n\t\t\t<span class='cNexusOrderBadge cNexusOrderBadge_\nCONTENT;\n\n$val = \"{$invoice->status}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n'>\nCONTENT;\n\n$val = \"istatus_{$invoice->status}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span> <strong class='ipsType_large cNexusPrice ipsPos_middle'>\nCONTENT;\n$return .= htmlspecialchars( $invoice->total, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/strong>\n\t\t<\/p>\n\t<\/div>\n\t\nCONTENT;\n\nif ( !$fromBillingAgreement ):\n$return .= <<<CONTENT\n\n\t\t<div class='ipsDataItem_main'>\n\t\t\t\nCONTENT;\n\n$summary = $invoice->summary();\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( count( $summary['items'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t\t<ul class='ipsDataList cNexusOrderList_items'>\n\t\t\t\t\t\nCONTENT;\n\nforeach ( $summary['items'] as $k => $item ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<li class='ipsDataItem'>\n\t\t\t\t\t\t\t<div class='ipsDataItem_icon'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $image = $item->image() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<img src=\"\nCONTENT;\n$return .= htmlspecialchars( $image->url, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsImage ipsThumb_tiny'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<div class='ipsNoThumb ipsNoThumb_product ipsThumb_tiny'>&nbsp;<\/div>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nif ( $url = $item->url() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $url, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsType_blendLinks ipsDataItem_title'>\nCONTENT;\n$return .= htmlspecialchars( $item->name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t\t<span class='ipsDataItem_title'>\nCONTENT;\n$return .= htmlspecialchars( $item->name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\t<p class='ipsType_light ipsType_reset'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'quantity', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n: \nCONTENT;\n$return .= htmlspecialchars( $item->quantity, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t\t\t\t\t<p class='ipsType_light ipsType_reset'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'invoice_unit_price', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n: \nCONTENT;\n$return .= htmlspecialchars( $item->price, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/ul>\n\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='ipsType_normal ipsType_light'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'orders_no_items', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/div>\n\t\t<div class='ipsDataItem_generic ipsDataItem_size8 ipsPos_top'>\n\t\t\t<ul class='ipsToolList ipsToolList_vertical'>\n\t\t\t\t\nCONTENT;\n\nif ( $invoice->status === $invoice::STATUS_PENDING ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $invoice->checkoutUrl(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsButton ipsButton_primary ipsButton_verySmall ipsButton_fullWidth' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_pay_now_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_pay_now', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t<\/li>\n\t\t\t\t\t<li>\n\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $invoice->url()->setQueryString( 'do', 'cancel' )->csrf(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' data-confirm class='ipsButton ipsButton_light ipsButton_verySmall ipsButton_fullWidth' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'orders_cancel_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'orders_cancel', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\n\t\t\t<\/ul>\n\t\t<\/div>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n<\/li>\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction invoices( $invoices, $pagination ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"global\", \"core\" )->pageHeader( \\IPS\\Member::loggedIn()->language()->get('orders_title') );\n$return .= <<<CONTENT\n\n\n\nCONTENT;\n\nif ( count( $invoices ) ):\n$return .= <<<CONTENT\n\n\t{$pagination}\n\t<ul class='ipsDataList ipsDataList_large cNexusOrderList ipsBox ipsPad'>\n\t\t\nCONTENT;\n\nforeach ( $invoices as $invoice ):\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"clients\", \\IPS\\Request::i()->app )->invoiceList( $invoice );\n$return .= <<<CONTENT\n\n\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t<\/ul>\n\t{$pagination}\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t<div class='ipsBox ipsPad ipsType_large ipsType_light ipsType_center'>\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'orders_none', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction networkStatus( $servers ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<div class=\"ipsPageHeader\">\n\t<header class=\"ipsSpacer_bottom\">\n\t\t<h1 class=\"ipsType_pageTitle\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'network_status', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h1>\n\t<\/header>\n<\/div>\n\n<div class=\"ipsType_richText ipsType_normal ipsSpacer_bottom ipsSpacer_double\">\n\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'network_status_text_val', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n<\/div>\n\n\nCONTENT;\n\nif ( count( $servers ) ):\n$return .= <<<CONTENT\n\n\t<ol class='ipsList_reset'>\n\t\t\nCONTENT;\n\nforeach ( $servers as $server ):\n$return .= <<<CONTENT\n\n\t\t\t<li class='ipsPad_half ipsAreaBackground_light \nCONTENT;\n\nif ( $server->monitor_fails ):\n$return .= <<<CONTENT\n\nCONTENT;\n\nif ( $server->monitor_acknowledged ):\n$return .= <<<CONTENT\nipsDataItem_error\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nipsDataItem_warning\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n ipsSpacer_bottom'>\n\t\t\t\t<div class=\"ipsDataItem_icon ipsType_large\">\n\t\t\t\t\t\nCONTENT;\n\nif ( $server->monitor_fails ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $server->monitor_acknowledged ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_large ipsBadge_negative'><i class=\"fa fa-exclamation-circle\"><\/i><\/span>\n\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_large ipsBadge_intermediary'><i class=\"fa fa-exclamation-triangle \"><\/i><\/span>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<span class='ipsBadge ipsBadge_icon ipsBadge_large ipsBadge_positive'><i class=\"fa fa-check-circle ipsType_success\"><\/i><\/span>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\t<div class=\"ipsDataItem_main\">\n\t\t\t\t\t<h4 class='ipsType_sectionHead'>\nCONTENT;\n\nif ( $server->monitor_fails ):\n$return .= <<<CONTENT\n<strong>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n$return .= htmlspecialchars( $server->hostname, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\nCONTENT;\n\nif ( $server->monitor_fails ):\n$return .= <<<CONTENT\n<\/strong>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n<\/h4>\n\t\t\t\t\t\nCONTENT;\n\nif ( $server->monitor_fails ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $server->monitor_acknowledged ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<p class='ipsDataItem_meta'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'network_status_known_issue', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<p class='ipsDataItem_meta'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'network_status_potential_issue', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<p class='ipsDataItem_meta'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'network_status_normal', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t<\/li>\t\t\t\t\n\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t<\/ol>\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t<div class='ipsPad_double ipsType_center ipsAreaBackground_positive'>\n\t\t<h2 class='ipsType_pageTitle'><span><i class='fa fa-check-circle'><\/i><\/span> &nbsp;&nbsp;\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'network_status_no_issues', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction paymentLog( $invoice ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n<ul class='ipsDataList cNexusPaymentLog'>\n\t\nCONTENT;\n\nforeach ( $invoice->transactions( array( \\IPS\\nexus\\Transaction::STATUS_PAID, \\IPS\\nexus\\Transaction::STATUS_WAITING, \\IPS\\nexus\\Transaction::STATUS_HELD, \\IPS\\nexus\\Transaction::STATUS_REVIEW, \\IPS\\nexus\\Transaction::STATUS_REFUSED, \\IPS\\nexus\\Transaction::STATUS_REFUNDED, \\IPS\\nexus\\Transaction::STATUS_PART_REFUNDED, \\IPS\\nexus\\Transaction::STATUS_GATEWAY_PENDING ) ) as $thisTransaction ):\n$return .= <<<CONTENT\n\n\t\t<li class='ipsDataItem'>\n\t\t\t\nCONTENT;\n\nif ( $thisTransaction->status === $thisTransaction::STATUS_PAID ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsDataItem_icon ipsType_success'>\n\t\t\t\t\t<i class=\"fa fa-check-circle\"><\/i>\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t<p class='ipsType_normal ipsType_reset'>\n\t\t\t\t\t\t<strong>\nCONTENT;\n\n$sprintf = array($thisTransaction->amount, ( $thisTransaction->method ) ? $thisTransaction->method->_title : \\IPS\\Member::loggedIn()->language()->get('account_credit')); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'transaction_paid', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t<\/p>\n\t\t\t\t\t<p class='ipsType_small ipsType_light ipsType_reset'>\n\t\t\t\t\t\t\nCONTENT;\n\n$val = ( $thisTransaction->date instanceof \\IPS\\DateTime ) ? $thisTransaction->date : \\IPS\\DateTime::ts( $thisTransaction->date );$return .= $val->html();\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/p>\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nelseif ( $thisTransaction->status === $thisTransaction::STATUS_WAITING ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsDataItem_icon ipsType_issue'>\n\t\t\t\t\t<i class=\"fa fa-exclamation-triangle\"><\/i>\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t<p class='ipsType_normal ipsType_reset'>\n\t\t\t\t\t\t<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $thisTransaction->url(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\"><strong>\nCONTENT;\n\n$sprintf = array($thisTransaction->method->_title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'transaction_wait', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/strong><\/a>\n\t\t\t\t\t<\/p>\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nelseif ( $thisTransaction->status === $thisTransaction::STATUS_HELD or $thisTransaction->status === $thisTransaction::STATUS_REVIEW ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsDataItem_icon ipsType_issue'>\n\t\t\t\t\t<i class=\"fa fa-clock-o\"><\/i>\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t<p class='ipsType_normal ipsType_reset'>\n\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'transaction_awaiting_approval', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n: \nCONTENT;\n\n$sprintf = array($thisTransaction->amount, $thisTransaction->method->_title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'transaction_paid', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t&nbsp;&nbsp;<span class='ipsType_light ipsType_noBreak'>\nCONTENT;\n\n$val = ( $thisTransaction->date instanceof \\IPS\\DateTime ) ? $thisTransaction->date : \\IPS\\DateTime::ts( $thisTransaction->date );$return .= $val->html();\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t<\/p>\n\t\t\t\t\t\nCONTENT;\n\nif ( $thisTransaction->gw_id ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<p class='ipsType_small ipsType_light ipsType_reset'>\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'payment_ref', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n: \nCONTENT;\n$return .= htmlspecialchars( $thisTransaction->gw_id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nelseif ( $thisTransaction->status === $thisTransaction::STATUS_GATEWAY_PENDING ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsDataItem_icon ipsType_issue'>\n\t\t\t\t\t<i class=\"fa fa-clock-o\"><\/i>\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t<p class='ipsType_normal ipsType_reset'>\n\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'transaction_processing', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n: \nCONTENT;\n\n$sprintf = array($thisTransaction->amount, $thisTransaction->method->_title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'transaction_paid', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t&nbsp;&nbsp;<span class='ipsType_light ipsType_noBreak'>\nCONTENT;\n\n$val = ( $thisTransaction->date instanceof \\IPS\\DateTime ) ? $thisTransaction->date : \\IPS\\DateTime::ts( $thisTransaction->date );$return .= $val->html();\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t<\/p>\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nelseif ( $thisTransaction->status === $thisTransaction::STATUS_REFUSED ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsDataItem_icon ipsType_warning'>\n\t\t\t\t\t<i class=\"fa fa-times-circle\"><\/i>\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t<p class='ipsType_normal ipsType_reset'>\n\t\t\t\t\t\t<strong>\nCONTENT;\n\n$sprintf = array($thisTransaction->amount, $thisTransaction->method->_title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'transaction_declined', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t<\/p>\n\t\t\t\t\t\nCONTENT;\n\nif ( $thisTransaction->gw_id ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<p class='ipsType_small ipsType_light ipsType_reset'>\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'payment_ref', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n: \nCONTENT;\n$return .= htmlspecialchars( $thisTransaction->gw_id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nelseif ( $thisTransaction->status === $thisTransaction::STATUS_REFUNDED ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsDataItem_icon ipsType_neutral'>\n\t\t\t\t\t<i class=\"fa fa-circle-arrow-left\"><\/i>\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t<p class='ipsType_normal ipsType_reset'>\n\t\t\t\t\t\t<strong>\nCONTENT;\n\n$sprintf = array($thisTransaction->amount, ( $thisTransaction->method ) ? $thisTransaction->method->_title : \\IPS\\Member::loggedIn()->language()->get('account_credit')); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'transaction_refunded', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t<\/p>\n\t\t\t\t\t\nCONTENT;\n\nif ( $thisTransaction->gw_id ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<p class='ipsType_small ipsType_light ipsType_reset'>\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'payment_ref', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n: \nCONTENT;\n$return .= htmlspecialchars( $thisTransaction->gw_id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nelseif ( $thisTransaction->status === $thisTransaction::STATUS_PART_REFUNDED ):\n$return .= <<<CONTENT\n\n\t\t\t\t<div class='ipsDataItem_icon ipsType_success'>\n\t\t\t\t\t<i class=\"fa fa-check-circle\"><\/i>\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t<p class='ipsType_normal ipsType_reset'>\n\t\t\t\t\t\t<strong>\nCONTENT;\n\n$sprintf = array($thisTransaction->amount, ( $thisTransaction->method ) ? $thisTransaction->method->_title : \\IPS\\Member::loggedIn()->language()->get('account_credit')); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'transaction_paid', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\t&nbsp;&nbsp;<span class='ipsType_light ipsType_noBreak'>\nCONTENT;\n\n$val = ( $thisTransaction->date instanceof \\IPS\\DateTime ) ? $thisTransaction->date : \\IPS\\DateTime::ts( $thisTransaction->date );$return .= $val->html();\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t<\/p>\n\t\t\t\t\t<p class='ipsType_medium ipsType_reset'>\n\t\t\t\t\t\t\nCONTENT;\n\n$sprintf = array($thisTransaction->partial_refund); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'transaction_part_refunded', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/p>\n\t\t\t\t\t\nCONTENT;\n\nif ( $thisTransaction->gw_id ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<p class='ipsType_small ipsType_light ipsType_reset'>\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'payment_ref', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n: \nCONTENT;\n$return .= htmlspecialchars( $thisTransaction->gw_id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/li>\n\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n<\/ul>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction purchase( $purchase ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\n$extra = $purchase->clientAreaPage();\n$return .= <<<CONTENT\n\n\n<div class='ipsBox'>\n<div class='ipsAreaBackground ipsPad cNexusPurchase_titleArea ipsClearfix'><\/div>\n\n<div class='ipsColumns ipsColumns_collapsePhone cNexusPurchase'>\n\t<div class='ipsColumn ipsColumn_wide'>\n\t\t\nCONTENT;\n\nif ( $image = $purchase->image() ):\n$return .= <<<CONTENT\n\n\t\t\t<span class='cNexusPurchase_image' style='background-image: url( \"\nCONTENT;\n\n$return .= htmlspecialchars( str_replace( array( '(', ')' ), array( '\\(', '\\)' ), $image->url ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" );'>&nbsp;<\/span>\n\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t<span class='ipsThumb ipsNoThumb \nCONTENT;\n\nif ( $purchase->type == 'giftvoucher' ):\n$return .= <<<CONTENT\nipsNoThumb_gift\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\nipsNoThumb_product\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n'>&nbsp;<\/span>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t<hr class='ipsHr'>\n\n\t\t\nCONTENT;\n\nif ( ( $purchase->expire AND $purchase->canRenewUntil(NULL,TRUE) ) OR $purchase->canCancel() ):\n$return .= <<<CONTENT\n\n\t\t\t<ul class='ipsToolList ipsToolList_vertical cNexusPurchase_renewActions'>\n\t\t\t\t\nCONTENT;\n\nif ( $purchase->expire AND $purchase->canRenewUntil(NULL,TRUE) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=purchases&do=renew&id={$purchase->id}\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, \"front\", \"clientspurchaserenew\", array( \\IPS\\Http\\Url\\Friendly::seoTitle( $purchase->name ) ), 0 ) );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_important ipsButton_fullWidth ipsButton_small' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_renew_now_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_renew_now', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $purchase->canCancel() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li><a href=\"\nCONTENT;\n\n$return .= str_replace( '&', '&amp;', \\IPS\\Http\\Url::internal( \"app=nexus&module=clients&controller=purchases&do=cancel&id={$purchase->id}\" . \"&csrfKey=\" . \\IPS\\Session::i()->csrfKey, \"front\", \"clientspurchasecancel\", array( \\IPS\\Http\\Url\\Friendly::seoTitle( $purchase->name ) ), 0 ) );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_link ipsButton_fullWidth ipsButton_small' data-confirm data-confirmSubMessage=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_cancel_renewal_confirm', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_cancel_renewal', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a><\/li>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t<dl class='ipsList_reset cNexusPurchase_info ipsSpacer_top'>\n\t\t\t<dt class='ipsType_minorHeading'><strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ps_start', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong><\/dt>\n\t\t\t<dd class='ipsType_normal'>\nCONTENT;\n$return .= htmlspecialchars( $purchase->start->localeDate(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/dd>\n\t\t\t\nCONTENT;\n\nif ( $purchase->expire ):\n$return .= <<<CONTENT\n\n\t\t\t\t<dt class='ipsType_minorHeading'><strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ps_expire', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong><\/dt>\n\t\t\t\t<dd class='ipsType_normal'>\nCONTENT;\n$return .= htmlspecialchars( $purchase->expire->localeDate(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/dd>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( $purchase->renewals and !$purchase->grouped_renewals ):\n$return .= <<<CONTENT\n\n\t\t\t\t<dt class='ipsType_minorHeading'><strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_renewal_terms', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong><\/dt>\n\t\t\t\t<dd class='ipsType_normal'>\nCONTENT;\n$return .= htmlspecialchars( $purchase->renewals, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/dd>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nif ( $purchase->billing_agreement AND !$purchase->billing_agreement->canceled ):\n$return .= <<<CONTENT\n\n\t\t\t\t<dt class='ipsType_minorHeading'><strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ps_billing_agreement', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/strong><\/dt>\n\t\t\t\t<dd class='ipsType_normal ipsType_blendLinks'><a href='\nCONTENT;\n$return .= htmlspecialchars( $purchase->billing_agreement->url(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n$return .= htmlspecialchars( $purchase->billing_agreement->gw_id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a><\/dd>\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t<\/dl>\n\t<\/div>\n\t<div class='ipsColumn ipsColumn_fluid'>\n\t\t<h1 class=\"ipsType_pageTitle\">\nCONTENT;\n$return .= htmlspecialchars( $purchase->name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/h1>\n\t\t<p class='ipsType_reset ipsType_normal'>\n\t\t\t\nCONTENT;\n\nif ( $purchase->cancelled ):\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='ipsBadge ipsBadge_negative'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_canceled', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>&nbsp;\n\t\t\t\nCONTENT;\n\nelseif ( !$purchase->active ):\n$return .= <<<CONTENT\n\n\t\t\t\t<span class='ipsBadge ipsBadge_neutral'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_expired', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>&nbsp;\n\t\t\t\nCONTENT;\n\nelseif ( $purchase->expire ):\n$return .= <<<CONTENT\n\n\t\t\t\t\nCONTENT;\n\nif ( $purchase->grace_period and $purchase->expire->getTimestamp() < time() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<span class='ipsBadge ipsBadge_positive'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_in_grace_period_front', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>&nbsp;\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t<span class='ipsBadge ipsBadge_positive'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_active', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>&nbsp;\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n            \nCONTENT;\n\n$val = \"{$purchase->getTypeTitle()}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t<\/p>\n\t\t<br><br>\n\n\t\t\nCONTENT;\n\nif ( $pendingInvoice = $purchase->invoice_pending and $pendingInvoice->status === $pendingInvoice::STATUS_PENDING ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsSpacer_bottom ipsMessage ipsMessage_info'>\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_pending_invoice', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( $purchase->canView() ):\n$return .= <<<CONTENT\n<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $pendingInvoice->checkoutUrl(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_pay_now_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_pay_now', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\nCONTENT;\n\nif ( $lkey = $purchase->licenseKey() ):\n$return .= <<<CONTENT\n\n\t\t\t<div class='ipsAreaBackground_light ipsPad ipsType_center ipsSpacer_bottom ipsSpacer_double'>\n\t\t\t\t<h2 class='ipsType_minorHeading ipsSpacer_bottom ipsSpacer_half'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_license_key', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t\t<div class='ipsType_large ipsType_monospace cNexusLicenseKey'>\n\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $lkey->key, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\nCONTENT;\n\nif ( isset( $extra['packageInfo'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t<h2 class='ipsType_sectionHead ipsSpacer_bottom ipsSpacer_half'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_package_info', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t\t<div class='ipsType_normal ipsType_richText ipsContained ipsType_break ipsSpacer_bottom'>\n\t\t\t\t{$extra['packageInfo']}\n\t\t\t<\/div>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t\t\nCONTENT;\n\nif ( isset( $extra['purchaseInfo'] ) ):\n$return .= <<<CONTENT\n\n\t\t\t<div>{$extra['purchaseInfo']}<\/div>\n\t\t\t<br><br>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/div>\n<\/div>\n<\/div>\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction purchaseList( $rootId, $purchases, $halfSize=FALSE, $fromBillingAgreement=NULL ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\nCONTENT;\n\nforeach ( $purchases[$rootId] as $purchase ):\n$return .= <<<CONTENT\n\n\t<li class='ipsSpacer_bottom ipsSpacer_double cNexusPurchaseList'>\n\t\t<div class='ipsBox'>\n\t\t\t<div class='ipsPad\nCONTENT;\n\nif ( $halfSize ):\n$return .= <<<CONTENT\n_half\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n ipsAreaBackground ipsPhotoPanel ipsPhotoPanel_mini'>\n\t\t\t\t<p class='ipsPos_right ipsType_reset ipsPad_half'>\n\t\t\t\t\t\nCONTENT;\n\nif ( $fromBillingAgreement ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $purchase->url(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsButton ipsButton_primary ipsButton_verySmall cNexusPurchaseList_button' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchases_manage_purchase', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'view', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $purchase->canRenewUntil(NULL,TRUE) ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t<strong>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchases_renewal_price', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n\n$return .= new \\IPS\\nexus\\Money( $purchase->renewal_price, ( ( isset( $_SESSION['currency'] ) and in_array( $_SESSION['currency'], \\IPS\\nexus\\Money::currencies() ) ) ? $_SESSION['currency'] : \\IPS\\nexus\\Customer::loggedIn()->defaultCurrency() ) );\n$return .= <<<CONTENT\n<\/strong> &nbsp;&nbsp;<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $purchase->url()->setQueryString( 'do', 'renew' )->csrf(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" class='ipsButton ipsButton_veryLight ipsButton_verySmall cNexusPurchaseList_button' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_renew_now_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_renew_now', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $purchase->url(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsButton ipsButton_primary ipsButton_verySmall cNexusPurchaseList_button' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchases_manage_purchase', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'manage', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/p>\n\t\t\t\t\nCONTENT;\n\nif ( $image = $purchase->image() ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $purchase->url(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsPos_left cNexusPurchaseList_image' style='background-image: url( \"\nCONTENT;\n\n$return .= htmlspecialchars( str_replace( array( '(', ')' ), array( '\\(', '\\)' ), $image->url ), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" );' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchases_manage_purchase', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">&nbsp;<\/a>\n\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t<a href='\nCONTENT;\n$return .= htmlspecialchars( $purchase->url(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' class='ipsPos_left ipsPos_left ipsNoThumb ipsNoThumb_product' title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchases_manage_purchase', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">&nbsp;<\/a>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<div>\n\t\t\t\t\t<h2 class='ipsType_sectionHead ipsType_blendLinks'><a href=\"\nCONTENT;\n$return .= htmlspecialchars( $purchase->url(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchases_manage_purchase', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n$return .= htmlspecialchars( $purchase->name, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a><\/h2>\n\t\t\t\t\t<p class='ipsType_reset ipsType_medium'>\nCONTENT;\n\n$val = \"{$purchase->getTypeTitle()}\"; $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( $val, \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t<div class='ipsPad\nCONTENT;\n\nif ( $halfSize ):\n$return .= <<<CONTENT\n_half\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n cNexusPurchaseList_info'>\n\t\t\n\t\t\t\t\nCONTENT;\n\nif ( !$fromBillingAgreement and $pendingInvoice = $purchase->invoice_pending and $pendingInvoice->status === $pendingInvoice::STATUS_PENDING ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<p class='ipsType_normal ipsType_reset'>\n\t\t\t\t\t\t<i class='fa fa-info-circle'><\/i> \nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_pending_invoice', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n \nCONTENT;\n\nif ( $pendingInvoice ):\n$return .= <<<CONTENT\n<a href=\"\nCONTENT;\n$return .= htmlspecialchars( $pendingInvoice->checkoutUrl(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\" title=\"\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_pay_now_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\">\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'order_pay_now', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/a>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t<\/p>\n\t\t\t\t\t<hr class='ipsHr'>\n\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\n\t\t\t\t<div class='ipsGrid ipsGrid_collapsePhone'>\n\t\t\t\t\t<div class='ipsGrid_span3'>\n\t\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_status', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t\t<span class='ipsType_normal'>\nCONTENT;\n\nif ( $purchase->active ):\n$return .= <<<CONTENT\n\nCONTENT;\n\nif ( $purchase->grace_period and $expire = $purchase->expire and $expire->getTimestamp() < time() ):\n$return .= <<<CONTENT\n<span class='ipsBadge ipsBadge_positive'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_in_grace_period_front', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n<span class='ipsBadge ipsBadge_positive'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_active', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\nelseif ( $purchase->cancelled ):\n$return .= <<<CONTENT\n<span class='ipsBadge ipsBadge_negative'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_canceled', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n<span class='ipsBadge ipsBadge_neutral'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchase_expired', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/span>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div class='ipsGrid_span3'>\n\t\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ps_start', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t\t<span class='ipsType_normal'>\nCONTENT;\n$return .= htmlspecialchars( $purchase->start->localeDate(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t<\/div>\n\t\t\t\t\t\nCONTENT;\n\nif ( $purchase->expire ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<div class='ipsGrid_span3'>\n\t\t\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ps_expire', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t\t\t<span class='ipsType_normal'>\nCONTENT;\n$return .= htmlspecialchars( $purchase->expire->localeDate(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/span>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( !$fromBillingAgreement and $purchase->billing_agreement AND !$purchase->billing_agreement->canceled ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t<div class='ipsGrid_span3'>\n\t\t\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ps_billing_agreement', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t\t\t<span class='ipsType_normal ipsType_blendLinks'><a href='\nCONTENT;\n$return .= htmlspecialchars( $purchase->billing_agreement->url(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'>\nCONTENT;\n$return .= htmlspecialchars( $purchase->billing_agreement->gw_id, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/a><\/span>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\t\t\nCONTENT;\n\nif ( isset( $purchases[ $purchase->id ]) ):\n$return .= <<<CONTENT\n\n\t\t\t<ul class='ipsList_reset cNexusPurchaseSubList'>\n\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"clients\", \\IPS\\Request::i()->app )->purchaseList( $purchase->id, $purchases, TRUE );\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t<\/li>\n\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction purchases( $purchases ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<h1 class='ipsType_pageTitle'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchases_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h1>\n\n\nCONTENT;\n\nif ( count( $purchases ) ):\n$return .= <<<CONTENT\n\n\t<p class='ipsType_reset ipsType_normal ipsSpacer_bottom'>\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchases_info', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t<\/p>\n\n\t<ul class='ipsList_reset'>\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Theme::i()->getTemplate( \"clients\", \\IPS\\Request::i()->app )->purchaseList( 0, $purchases );\n$return .= <<<CONTENT\n\n\t<\/ul>\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t<br>\n\t<div class='ipsType_large ipsType_center ipsType_light ipsSpacer_bottom'>\n\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'purchases_none', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction referrals( $url, $rules ) {\n\t\t$return = '';\n\t\t$return .= <<<CONTENT\n\n\n<h1 class='ipsType_pageTitle ipsSpacer_bottom'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'referrals', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h1>\n\n\nCONTENT;\n\nif ( \\IPS\\Settings::i()->nexus_com_rules ):\n$return .= <<<CONTENT\n\n\t<h2 class='ipsType_sectionHead'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'referrals_title', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\n\t\nCONTENT;\n\nif ( count( $rules ) > 1 ):\n$return .= <<<CONTENT\n\n\t\t<p class='ipsType_reset ipsType_normal'>\n\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'referrals_desc', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t<\/p>\n\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n\t<ul class='ipsDataList'>\n\t\t\nCONTENT;\n\nforeach ( $rules as $rule ):\n$return .= <<<CONTENT\n\n\t\t\t<li class='ipsDataItem'>\n\t\t\t\t<div class='ipsDataItem_generic ipsDataItem_size2 ipsType_center'>\n\t\t\t\t\t<span class='cReferralBadge'>\nCONTENT;\n$return .= htmlspecialchars( $rule->commission, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n%<\/span>\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t<strong class='ipsType_normal'>\nCONTENT;\n$return .= htmlspecialchars( $rule->description(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n<\/strong>\n\t\t\t\t\t\nCONTENT;\n\n$limit = $rule->commissionLimit();\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $rule->purchase_packages or $limit != '' ):\n$return .= <<<CONTENT\n<p class='ipsType_reset ipsType_medium ipsType_light'>(\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $rule->purchase_packages ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nif ( $rule->purchase_package_limit ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ref_comm_limit_yes', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\t\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ref_comm_limit_no', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $rule->commission_limit ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t\t\nCONTENT;\n$return .= htmlspecialchars( $rule->commissionLimit(), ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t\t\nCONTENT;\n\nif ( $rule->purchase_packages or $limit != '' ):\n$return .= <<<CONTENT\n)<\/p>\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\t\t\t\t<\/div>\n\t\t\t<\/li>\n\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t<\/ul>\n\nCONTENT;\n\nelse:\n$return .= <<<CONTENT\n\n\t<p class='ipsType_reset ipsType_normal'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'nexus_com_rules_val', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/p>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\n\n<div class='ipsBox ipsSpacer_top' data-controller='nexus.front.clients.referrals'>\n\t<h2 class='ipsType_sectionTitle ipsType_reset'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'referral_link', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t<div class='ipsPad_half'>\n\t\t<ul class='ipsDataList'>\n\t\t\t<li class='ipsDataItem'>\n\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'referral_directlink', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t<input type='text' class='ipsField_fullWidth' value=\"\nCONTENT;\n$return .= htmlspecialchars( $url, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n\">\n\t\t\t\t<\/div>\n\t\t\t<\/li>\n\t\t\t<li class='ipsDataItem'>\n\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'referral_html', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t<input type='text' class='ipsField_fullWidth' value=\"&lt;a href='\nCONTENT;\n$return .= htmlspecialchars( $url, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'&gt;\nCONTENT;\n\n$return .= \\IPS\\Settings::i()->board_name;\n$return .= <<<CONTENT\n&lt;\/a&gt;\">\n\t\t\t\t<\/div>\n\t\t\t<\/li>\n\t\t\t<li class='ipsDataItem'>\n\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'referral_bbcode', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t<input type='text' class='ipsField_fullWidth' value=\"[url='\nCONTENT;\n$return .= htmlspecialchars( $url, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n']\nCONTENT;\n\n$return .= \\IPS\\Settings::i()->board_name;\n$return .= <<<CONTENT\n[\/url]\">\n\t\t\t\t<\/div>\n\t\t\t<\/li>\n\t\t<\/ul>\n\t<\/div>\n<\/div>\n\n\nCONTENT;\n\nif ( count( \\IPS\\nexus\\ReferralBanner::roots() ) ):\n$return .= <<<CONTENT\n\n\t<div class='ipsBox ipsSpacer_top' data-controller='nexus.front.clients.referrals'>\n\t\t<h2 class='ipsType_sectionTitle ipsType_reset'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'referral_banners', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h2>\n\t\t<div class='ipsPad_half ipsAreaBackground_light'>\n\t\t\t<ul class='ipsDataList'>\n\t\t\t\t\nCONTENT;\n\nforeach ( \\IPS\\nexus\\ReferralBanner::roots() as $banner ):\n$return .= <<<CONTENT\n\n\t\t\t\t\t<li class='ipsDataItem'>\n\t\t\t\t\t\t<div class='ipsDataItem_main'>\n\t\t\t\t\t\t\t<div class='ipsPad_half ipsType_center ipsSpacer_bottom ipsSpacer_half'>\n\t\t\t\t\t\t\t\t{$banner->_title}\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<div class='ipsGrid'>\n\t\t\t\t\t\t\t\t<div class='ipsGrid_span6'>\n\t\t\t\t\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'referral_html', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t\t\t\t\t<input type='text' class='ipsField_fullWidth' value=\"&lt;a href='\nCONTENT;\n$return .= htmlspecialchars( $url, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'&gt;&lt;img src='\nCONTENT;\n$return .= htmlspecialchars( $banner->url, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n' alt='\nCONTENT;\n\n$return .= \\IPS\\Settings::i()->board_name;\n$return .= <<<CONTENT\n'&gt;&lt;\/a&gt;\">\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t\t<div class='ipsGrid_span6'>\n\t\t\t\t\t\t\t\t\t<h3 class='ipsType_minorHeading'>\nCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'referral_bbcode', \\IPS\\HTMLENTITIES, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<CONTENT\n<\/h3>\n\t\t\t\t\t\t\t\t\t<input type='text' class='ipsField_fullWidth' value=\"[url='\nCONTENT;\n$return .= htmlspecialchars( $url, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n'][img]\nCONTENT;\n$return .= htmlspecialchars( $banner->url, ENT_QUOTES | \\IPS\\HTMLENTITIES, 'UTF-8', FALSE );\n$return .= <<<CONTENT\n[\/img][\/url]\">\n\t\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t\t<\/div>\n\t\t\t\t\t\t<\/div>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nCONTENT;\n\nendforeach;\n$return .= <<<CONTENT\n\n\t\t\t<\/ul>\n\t\t<\/div>\n\t<\/div>\n\nCONTENT;\n\nendif;\n$return .= <<<CONTENT\n\nCONTENT;\n\n\t\treturn $return;\n}}"
VALUE;
